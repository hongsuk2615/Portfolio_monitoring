<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>대시보드 - 모니터링 시스템</title>
    <th:block th:replace="~{layout/commonHeader :: commonHeader}"></th:block>
</head>
<body>
<th:block th:replace="~{layout/sidebar :: sidebar}"></th:block>

<div class="content">
    <div class="page-header">
        <h2><i class="bi bi-bar-chart-fill"></i> 대시보드</h2>
        <p>시스템 전체 현황을 한눈에 확인하세요</p>
    </div>

    <!-- 주요 지표 카드 -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6>전체 서비스</h6>
                        <div class="stat-value" id="totalServices">0</div>
                        <div class="stat-label">개의 서비스 실행 중</div>
                    </div>
                    <i class="bi bi-server"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6>정상 서비스</h6>
                        <div class="stat-value text-success" id="healthyServices">0</div>
                        <div class="stat-label">정상 작동 중</div>
                    </div>
                    <i class="bi bi-check-circle-fill text-success"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6>배치 작업</h6>
                        <div class="stat-value text-warning" id="batchJobs">0</div>
                        <div class="stat-label">실행 대기 중</div>
                    </div>
                    <i class="bi bi-clock-history text-warning"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6>배포 현황</h6>
                        <div class="stat-value text-info" id="deployments">0</div>
                        <div class="stat-label">최근 24시간</div>
                    </div>
                    <i class="bi bi-rocket-takeoff-fill text-info"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- 차트 영역 -->
    <div class="row g-4">
        <div class="col-md-8">
            <div class="chart-container">
                <h5><i class="bi bi-graph-up"></i> 시스템 리소스 사용률</h5>
                <canvas id="resourceChart"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-container">
                <h5><i class="bi bi-pie-chart-fill"></i> 서비스 상태</h5>
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 최근 활동 -->
    <div class="table-container">
        <h5><i class="bi bi-activity"></i> 최근 활동</h5>
        <table class="table">
            <thead>
            <tr>
                <th>시간</th>
                <th>서비스</th>
                <th>활동</th>
                <th>상태</th>
            </tr>
            </thead>
            <tbody id="recentActivity">
            <tr>
                <td colspan="4" class="text-center" style="color: #64748b;">
                    <i class="bi bi-hourglass-split"></i> 데이터를 불러오는 중...
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // 차트 설정
    const chartColors = {
        primary: '#38bdf8',
        success: '#22c55e',
        warning: '#f59e0b',
        danger: '#ef4444',
        background: '#1e293b'
    };

    // 리소스 사용률 차트
    const resourceCtx = document.getElementById('resourceChart').getContext('2d');
    const resourceChart = new Chart(resourceCtx, {
        type: 'line',
        data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
            datasets: [{
                label: 'CPU 사용률 (%)',
                data: [45, 59, 80, 81, 56, 55],
                borderColor: chartColors.primary,
                backgroundColor: 'rgba(56, 189, 248, 0.1)',
                tension: 0.4
            }, {
                label: '메모리 사용률 (%)',
                data: [28, 48, 40, 50, 60, 70],
                borderColor: chartColors.success,
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#cbd5e1' }
                }
            },
            scales: {
                y: {
                    ticks: { color: '#cbd5e1' },
                    grid: { color: '#334155' }
                },
                x: {
                    ticks: { color: '#cbd5e1' },
                    grid: { color: '#334155' }
                }
            }
        }
    });

    // 서비스 상태 차트
    const statusCtx = document.getElementById('statusChart').getContext('2d');
    const statusChart = new Chart(statusCtx, {
        type: 'doughnut',
        data: {
            labels: ['정상', '경고', '오류'],
            datasets: [{
                data: [12, 3, 1],
                backgroundColor: [
                    chartColors.success,
                    chartColors.warning,
                    chartColors.danger
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#cbd5e1', padding: 20 }
                }
            }
        }
    });

    // 대시보드 데이터 로드
    async function loadDashboardData() {
        try {
            // API 호출 예시
            document.getElementById('totalServices').textContent = '16';
            document.getElementById('healthyServices').textContent = '12';
            document.getElementById('batchJobs').textContent = '5';
            document.getElementById('deployments').textContent = '8';

            // 최근 활동 로드
            const activities = [
                { time: '2분 전', service: 'Tech Stack', activity: '배포 완료', status: 'success' },
                { time: '15분 전', service: 'Monitoring', activity: '헬스체크 성공', status: 'success' },
                { time: '1시간 전', service: 'Batch Server', activity: '배치 작업 실행', status: 'info' },
                { time: '2시간 전', service: 'API Gateway', activity: '재시작', status: 'warning' }
            ];

            const tbody = document.getElementById('recentActivity');
            tbody.innerHTML = activities.map(a => `
                <tr>
                    <td>${a.time}</td>
                    <td>${a.service}</td>
                    <td>${a.activity}</td>
                    <td><span class="badge badge-${a.status}">${a.status}</span></td>
                </tr>
            `).join('');
        } catch (error) {
            console.error('대시보드 데이터 로드 실패:', error);
        }
    }

    // 페이지 로드 시 데이터 로드
    loadDashboardData();

    // 30초마다 데이터 갱신
    setInterval(loadDashboardData, 30000);
</script>
</body>
</html>
